<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Ch·ª©c NƒÉng H·ªßy B·∫°n B√® - Tribe</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        .test-result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 4px;
        }
        .test-success {
            background-color: #d1edff;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .test-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .test-info {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">üß™ Test Ch·ª©c NƒÉng H·ªßy B·∫°n B√®</h1>
        
        <div class="alert alert-info">
            <h5>üìã H∆∞·ªõng d·∫´n test:</h5>
            <ol>
                <li>ƒê·∫£m b·∫£o backend ƒëang ch·∫°y ·ªü <code>localhost:8080</code></li>
                <li>ƒê·∫£m b·∫£o frontend ƒëang ch·∫°y ·ªü <code>localhost:3000</code></li>
                <li>ƒêƒÉng nh·∫≠p v√†o h·ªá th·ªëng</li>
                <li>Th·ª±c hi·ªán c√°c test case b√™n d∆∞·ªõi</li>
            </ol>
        </div>

        <!-- Test 1: Ki·ªÉm tra API Endpoint -->
        <div class="test-section">
            <h4>üîç Test 1: Ki·ªÉm tra API Endpoint</h4>
            <p>Ki·ªÉm tra xem endpoint <code>/api/friendships/unfriend</code> c√≥ t·ªìn t·∫°i v√† ho·∫°t ƒë·ªông kh√¥ng.</p>
            <button class="btn btn-primary" onclick="testUnfriendEndpoint()">Test API Endpoint</button>
            <div id="test1-result"></div>
        </div>

        <!-- Test 2: Test H·ªßy K·∫øt B·∫°n -->
        <div class="test-section">
            <h4>üë• Test 2: Test H·ªßy K·∫øt B·∫°n</h4>
            <div class="row">
                <div class="col-md-6">
                    <label for="senderId" class="form-label">Sender ID (Ng∆∞·ªùi g·ª≠i y√™u c·∫ßu h·ªßy):</label>
                    <input type="text" class="form-control" id="senderId" placeholder="Nh·∫≠p sender ID">
                </div>
                <div class="col-md-6">
                    <label for="receiverId" class="form-label">Receiver ID (Ng∆∞·ªùi b·ªã h·ªßy k·∫øt b·∫°n):</label>
                    <input type="text" class="form-control" id="receiverId" placeholder="Nh·∫≠p receiver ID">
                </div>
            </div>
            <button class="btn btn-danger mt-3" onclick="testUnfriend()">Test H·ªßy K·∫øt B·∫°n</button>
            <div id="test2-result"></div>
        </div>

        <!-- Test 3: Test UI Component -->
        <div class="test-section">
            <h4>üé® Test 3: Test UI Component</h4>
            <p>Ki·ªÉm tra component FriendshipButton c√≥ hi·ªÉn th·ªã n√∫t "H·ªßy k·∫øt b·∫°n" khi ƒë√£ l√† b·∫°n b√®.</p>
            <button class="btn btn-success" onclick="openProfilePage()">M·ªü Trang Profile</button>
            <div class="mt-2">
                <small class="text-muted">Sau khi m·ªü trang profile, ki·ªÉm tra xem c√≥ n√∫t "H·ªßy k·∫øt b·∫°n" trong dropdown menu kh√¥ng.</small>
            </div>
        </div>

        <!-- Test 4: Test Notification -->
        <div class="test-section">
            <h4>üîî Test 4: Test Notification</h4>
            <p>Ki·ªÉm tra xem c√≥ th√¥ng b√°o ƒë∆∞·ª£c g·ª≠i khi h·ªßy k·∫øt b·∫°n kh√¥ng.</p>
            <button class="btn btn-warning" onclick="testNotification()">Test Notification</button>
            <div id="test4-result"></div>
        </div>

        <!-- Test 5: Test Error Cases -->
        <div class="test-section">
            <h4>‚ùå Test 5: Test Error Cases</h4>
            <p>Ki·ªÉm tra c√°c tr∆∞·ªùng h·ª£p l·ªói khi h·ªßy k·∫øt b·∫°n.</p>
            <button class="btn btn-secondary" onclick="testErrorCases()">Test Error Cases</button>
            <div id="test5-result"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';

        // Test 1: Ki·ªÉm tra API Endpoint
        async function testUnfriendEndpoint() {
            const resultDiv = document.getElementById('test1-result');
            resultDiv.innerHTML = '<div class="test-info">ƒêang ki·ªÉm tra...</div>';

            try {
                const response = await fetch(`${API_BASE_URL}/friendships/unfriend`, {
                    method: 'OPTIONS'
                });

                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="test-success">
                            ‚úÖ Endpoint t·ªìn t·∫°i v√† c√≥ th·ªÉ truy c·∫≠p ƒë∆∞·ª£c<br>
                            Method: DELETE<br>
                            URL: ${API_BASE_URL}/friendships/unfriend
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="test-error">
                            ‚ùå Endpoint kh√¥ng t·ªìn t·∫°i ho·∫∑c kh√¥ng th·ªÉ truy c·∫≠p<br>
                            Status: ${response.status}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-error">
                        ‚ùå L·ªói khi ki·ªÉm tra endpoint: ${error.message}<br>
                        ƒê·∫£m b·∫£o backend ƒëang ch·∫°y ·ªü localhost:8080
                    </div>
                `;
            }
        }

        // Test 2: Test H·ªßy K·∫øt B·∫°n
        async function testUnfriend() {
            const senderId = document.getElementById('senderId').value;
            const receiverId = document.getElementById('receiverId').value;
            const resultDiv = document.getElementById('test2-result');

            if (!senderId || !receiverId) {
                resultDiv.innerHTML = '<div class="test-error">‚ùå Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Sender ID v√† Receiver ID</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="test-info">ƒêang th·ª±c hi·ªán h·ªßy k·∫øt b·∫°n...</div>';

            try {
                const response = await fetch(`${API_BASE_URL}/friendships/unfriend?senderId=${senderId}&receiverId=${receiverId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok && data.status?.success) {
                    resultDiv.innerHTML = `
                        <div class="test-success">
                            ‚úÖ H·ªßy k·∫øt b·∫°n th√†nh c√¥ng!<br>
                            Message: ${data.status.displayMessage}<br>
                            Code: ${data.status.code}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="test-error">
                            ‚ùå H·ªßy k·∫øt b·∫°n th·∫•t b·∫°i<br>
                            Message: ${data.status?.displayMessage || 'Unknown error'}<br>
                            Code: ${data.status?.code || 'Unknown'}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-error">
                        ‚ùå L·ªói khi th·ª±c hi·ªán h·ªßy k·∫øt b·∫°n: ${error.message}
                    </div>
                `;
            }
        }

        // Test 3: M·ªü trang profile
        function openProfilePage() {
            const receiverId = document.getElementById('receiverId').value;
            if (receiverId) {
                window.open(`http://localhost:3000/profile/${receiverId}`, '_blank');
            } else {
                alert('Vui l√≤ng nh·∫≠p Receiver ID tr∆∞·ªõc khi m·ªü trang profile');
            }
        }

        // Test 4: Test Notification
        async function testNotification() {
            const resultDiv = document.getElementById('test4-result');
            resultDiv.innerHTML = '<div class="test-info">ƒêang ki·ªÉm tra notification...</div>';

            try {
                // Ki·ªÉm tra xem c√≥ endpoint notification kh√¥ng
                const response = await fetch(`${API_BASE_URL.replace('/friendships', '')}/notifications/test`, {
                    method: 'GET'
                });

                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div class="test-success">
                            ‚úÖ Notification service ƒëang ho·∫°t ƒë·ªông<br>
                            Endpoint: /api/notifications
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="test-info">
                            ‚ÑπÔ∏è Kh√¥ng th·ªÉ ki·ªÉm tra notification service tr·ª±c ti·∫øp<br>
                            Notification s·∫Ω ƒë∆∞·ª£c t·∫°o khi th·ª±c hi·ªán h·ªßy k·∫øt b·∫°n th√†nh c√¥ng
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-info">
                        ‚ÑπÔ∏è Kh√¥ng th·ªÉ ki·ªÉm tra notification service: ${error.message}<br>
                        Notification s·∫Ω ƒë∆∞·ª£c t·∫°o khi th·ª±c hi·ªán h·ªßy k·∫øt b·∫°n th√†nh c√¥ng
                    </div>
                `;
            }
        }

        // Test 5: Test Error Cases
        async function testErrorCases() {
            const resultDiv = document.getElementById('test5-result');
            resultDiv.innerHTML = '<div class="test-info">ƒêang test c√°c tr∆∞·ªùng h·ª£p l·ªói...</div>';

            const testCases = [
                { senderId: 'invalid-id', receiverId: 'invalid-id', description: 'Invalid IDs' },
                { senderId: '', receiverId: '', description: 'Empty IDs' },
                { senderId: 'non-existent-1', receiverId: 'non-existent-2', description: 'Non-existent users' }
            ];

            let results = '';

            for (const testCase of testCases) {
                try {
                    const response = await fetch(`${API_BASE_URL}/friendships/unfriend?senderId=${testCase.senderId}&receiverId=${testCase.receiverId}`, {
                        method: 'DELETE'
                    });

                    const data = await response.json();

                    if (!response.ok || !data.status?.success) {
                        results += `
                            <div class="test-success">
                                ‚úÖ ${testCase.description}: X·ª≠ l√Ω l·ªói ƒë√∫ng<br>
                                Message: ${data.status?.displayMessage || 'Error handled'}
                            </div>
                        `;
                    } else {
                        results += `
                            <div class="test-error">
                                ‚ùå ${testCase.description}: Kh√¥ng x·ª≠ l√Ω l·ªói ƒë√∫ng<br>
                                Expected: Error, Got: Success
                            </div>
                        `;
                    }
                } catch (error) {
                    results += `
                        <div class="test-success">
                            ‚úÖ ${testCase.description}: X·ª≠ l√Ω l·ªói ƒë√∫ng<br>
                            Error: ${error.message}
                        </div>
                    `;
                }
            }

            resultDiv.innerHTML = results;
        }

        // Auto-fill test data
        document.addEventListener('DOMContentLoaded', function() {
            // C√≥ th·ªÉ th√™m auto-fill cho test data n·∫øu c·∫ßn
            console.log('Test page loaded. Ready to test unfriend feature.');
        });
    </script>
</body>
</html> 