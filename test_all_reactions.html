<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test All Comment Reactions</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .reaction-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .reaction-test {
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .reaction-emoji {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .reaction-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .reaction-type {
            color: #666;
            font-size: 12px;
            margin-bottom: 10px;
        }
        button {
            margin: 5px;
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 3px;
            white-space: pre-wrap;
            font-size: 12px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        .current-reaction {
            background-color: #e3f2fd;
            border-color: #2196f3;
        }
        .stats-display {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Test T·∫•t C·∫£ Comment Reactions</h1>
    
    <div class="test-section">
        <h3>1. T·∫°o Comment ƒë·ªÉ Test</h3>
        <label>Post ID:</label>
        <input type="number" id="postId" value="20">
        <label>User ID:</label>
        <input type="text" id="userId" value="a033d64c-4286-4826-8827-f5b69af13f96">
        <label>Comment Content:</label>
        <textarea id="commentContent" rows="3" placeholder="Nh·∫≠p n·ªôi dung comment ƒë·ªÉ test t·∫•t c·∫£ reactions...">Comment ƒë·ªÉ test t·∫•t c·∫£ lo·∫°i reaction</textarea>
        <br><br>
        <button onclick="createComment()">T·∫°o Comment</button>
        <div id="createCommentResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>2. Test T·∫•t C·∫£ Lo·∫°i Reaction</h3>
        <label>Comment ID:</label>
        <input type="number" id="commentId" placeholder="Nh·∫≠p ID comment t·ª´ b∆∞·ªõc 1">
        <br><br>
        
        <div class="reaction-grid">
            <div class="reaction-test" id="like-test">
                <div class="reaction-emoji">üëç</div>
                <div class="reaction-name">Th√≠ch</div>
                <div class="reaction-type">LIKE</div>
                <button onclick="testReaction('LIKE')">Test LIKE</button>
                <div id="like-result" class="result"></div>
            </div>
            
            <div class="reaction-test" id="love-test">
                <div class="reaction-emoji">‚ù§Ô∏è</div>
                <div class="reaction-name">Y√™u th√≠ch</div>
                <div class="reaction-type">LOVE</div>
                <button onclick="testReaction('LOVE')">Test LOVE</button>
                <div id="love-result" class="result"></div>
            </div>
            
            <div class="reaction-test" id="haha-test">
                <div class="reaction-emoji">üòÇ</div>
                <div class="reaction-name">Haha</div>
                <div class="reaction-type">HAHA</div>
                <button onclick="testReaction('HAHA')">Test HAHA</button>
                <div id="haha-result" class="result"></div>
            </div>
            
            <div class="reaction-test" id="wow-test">
                <div class="reaction-emoji">üòÆ</div>
                <div class="reaction-name">Wow</div>
                <div class="reaction-type">WOW</div>
                <button onclick="testReaction('WOW')">Test WOW</button>
                <div id="wow-result" class="result"></div>
            </div>
            
            <div class="reaction-test" id="sad-test">
                <div class="reaction-emoji">üò¢</div>
                <div class="reaction-name">Bu·ªìn</div>
                <div class="reaction-type">SAD</div>
                <button onclick="testReaction('SAD')">Test SAD</button>
                <div id="sad-result" class="result"></div>
            </div>
            
            <div class="reaction-test" id="angry-test">
                <div class="reaction-emoji">üò†</div>
                <div class="reaction-name">Gi·∫≠n</div>
                <div class="reaction-type">ANGRY</div>
                <button onclick="testReaction('ANGRY')">Test ANGRY</button>
                <div id="angry-result" class="result"></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h3>3. Th·ªëng K√™ Reaction</h3>
        <button onclick="getReactionStats()">L·∫•y Th·ªëng K√™</button>
        <div id="statsResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>4. X√≥a T·∫•t C·∫£ Reaction</h3>
        <button onclick="deleteAllReactions()">X√≥a T·∫•t C·∫£</button>
        <div id="deleteResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>5. Test Toggle Reaction</h3>
        <p>Click v√†o b·∫•t k·ª≥ reaction n√†o ·ªü tr√™n ƒë·ªÉ toggle (t·∫°o/x√≥a) reaction ƒë√≥.</p>
        <div id="toggleResult" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        let testCommentId = null;
        let currentReaction = null;

        async function createComment() {
            const postId = document.getElementById('postId').value;
            const userId = document.getElementById('userId').value;
            const content = document.getElementById('commentContent').value;
            const resultDiv = document.getElementById('createCommentResult');

            try {
                const requestBody = {
                    content: content
                };

                const response = await fetch(`${API_BASE}/post-comments/create?postId=${postId}&userId=${userId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ Comment t·∫°o th√†nh c√¥ng!\nID: ${data.data.id}\nN·ªôi dung: ${data.data.content}`;
                    testCommentId = data.data.id;
                    document.getElementById('commentId').value = testCommentId;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå Error: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Network Error: ${error.message}`;
            }
        }

        async function testReaction(reactionType) {
            const commentId = document.getElementById('commentId').value;
            const userId = document.getElementById('userId').value;
            const resultDiv = document.getElementById(`${reactionType.toLowerCase()}-result`);

            if (!commentId) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '‚ùå Vui l√≤ng nh·∫≠p Comment ID tr∆∞·ªõc!';
                return;
            }

            try {
                const requestBody = {
                    reactionType: reactionType
                };

                const response = await fetch(`${API_BASE}/comment-reactions/toggle?commentId=${commentId}&userId=${userId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    if (data.data) {
                        resultDiv.textContent = `‚úÖ ƒê√£ t·∫°o ${reactionType}!\nID: ${data.data.id}\nUser: ${data.data.userName}`;
                        currentReaction = data.data;
                        updateReactionDisplay(reactionType);
                    } else {
                        resultDiv.textContent = `‚úÖ ƒê√£ b·ªè ${reactionType}!`;
                        currentReaction = null;
                        clearReactionDisplay();
                    }
                    
                    // Refresh stats
                    getReactionStats();
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå Error: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Network Error: ${error.message}`;
            }
        }

        function updateReactionDisplay(reactionType) {
            // Clear all highlights
            document.querySelectorAll('.reaction-test').forEach(test => {
                test.classList.remove('current-reaction');
            });
            
            // Highlight current reaction
            const currentTest = document.getElementById(`${reactionType.toLowerCase()}-test`);
            if (currentTest) {
                currentTest.classList.add('current-reaction');
            }
        }

        function clearReactionDisplay() {
            document.querySelectorAll('.reaction-test').forEach(test => {
                test.classList.remove('current-reaction');
            });
        }

        async function getReactionStats() {
            const commentId = document.getElementById('commentId').value;
            const resultDiv = document.getElementById('statsResult');

            if (!commentId) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '‚ùå Vui l√≤ng nh·∫≠p Comment ID tr∆∞·ªõc!';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/comment-reactions/stats/${commentId}`);
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    let html = '<div class="stats-display"><h4>üìä Th·ªëng K√™ Reaction:</h4>';
                    
                    const reactionEmojis = {
                        'LIKE': 'üëç',
                        'LOVE': '‚ù§Ô∏è',
                        'HAHA': 'üòÇ',
                        'WOW': 'üòÆ',
                        'SAD': 'üò¢',
                        'ANGRY': 'üò†'
                    };
                    
                    Object.entries(data.data).forEach(([type, count]) => {
                        const emoji = reactionEmojis[type] || '‚ùì';
                        html += `<div><strong>${emoji} ${type}:</strong> ${count}</div>`;
                    });
                    
                    if (Object.keys(data.data).length === 0) {
                        html += '<div>Ch∆∞a c√≥ reaction n√†o</div>';
                    }
                    
                    html += '</div>';
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå Error: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Network Error: ${error.message}`;
            }
        }

        async function deleteAllReactions() {
            const commentId = document.getElementById('commentId').value;
            const userId = document.getElementById('userId').value;
            const resultDiv = document.getElementById('deleteResult');

            if (!commentId) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '‚ùå Vui l√≤ng nh·∫≠p Comment ID tr∆∞·ªõc!';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/comment-reactions/delete?commentId=${commentId}&userId=${userId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ X√≥a reaction th√†nh c√¥ng!`;
                    currentReaction = null;
                    clearReactionDisplay();
                    
                    // Clear all result divs
                    ['like', 'love', 'haha', 'wow', 'sad', 'angry'].forEach(type => {
                        const resultDiv = document.getElementById(`${type}-result`);
                        if (resultDiv) {
                            resultDiv.textContent = '';
                            resultDiv.className = 'result';
                        }
                    });
                    
                    // Refresh stats
                    getReactionStats();
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå Error: ${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Network Error: ${error.message}`;
            }
        }

        // Auto-refresh stats every 5 seconds
        setInterval(() => {
            if (testCommentId) {
                getReactionStats();
            }
        }, 5000);
    </script>
</body>
</html>
