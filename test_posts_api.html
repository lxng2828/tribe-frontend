<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Posts API - C·∫•u tr√∫c m·ªõi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f0f2f5;
            color: #1c1e21;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #1877f2;
            margin-bottom: 10px;
        }

        .api-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #1877f2;
            margin-bottom: 20px;
        }

        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .test-section h3 {
            color: #1877f2;
            margin-bottom: 15px;
        }

        .btn {
            background: #1877f2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #166fe5;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #42a5f5;
        }

        .btn-secondary:hover {
            background: #1e88e5;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1877f2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }

        .result pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 12px;
            line-height: 1.4;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }

        .post-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1877f2;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .post-info h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
        }

        .post-meta {
            font-size: 12px;
            color: #65676b;
        }

        .post-content {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .post-stats {
            display: flex;
            gap: 20px;
            font-size: 12px;
            color: #65676b;
        }

        .visibility-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            margin-left: 10px;
        }

        .visibility-public {
            background: #e7f3ff;
            color: #1877f2;
        }

        .visibility-friends {
            background: #fff3cd;
            color: #856404;
        }

        .visibility-private {
            background: #f8d7da;
            color: #721c24;
        }

        .reactions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .reaction {
            background: #f0f2f5;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
        }

        .comments {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #f0f2f5;
        }

        .comment {
            padding: 5px 0;
            font-size: 12px;
            color: #65676b;
        }

        .media {
            margin: 10px 0;
        }

        .media img {
            max-width: 100%;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Test Posts API - C·∫•u tr√∫c m·ªõi</h1>
            <p>Demo API l·∫•y t·∫•t c·∫£ b√†i vi·∫øt v·ªõi c·∫•u tr√∫c response m·ªõi</p>
        </div>

        <div class="api-info">
            <strong>üìã C·∫•u tr√∫c API Response:</strong><br>
            <code>GET /api/posts/all</code> - Tr·∫£ v·ªÅ danh s√°ch b√†i vi·∫øt v·ªõi format status v√† data
        </div>

        <div class="test-section">
            <h3>üß™ Test API Calls</h3>
            <button class="btn" onclick="testGetAllPosts()">
                <span id="loading-icon" style="display: none;" class="loading"></span>
                L·∫•y t·∫•t c·∫£ b√†i vi·∫øt
            </button>
            <button class="btn btn-secondary" onclick="testGetPostsByPage()">
                <span id="loading-page-icon" style="display: none;" class="loading"></span>
                L·∫•y b√†i vi·∫øt theo trang
            </button>
            <button class="btn btn-secondary" onclick="clearResults()">X√≥a k·∫øt qu·∫£</button>
            
            <div id="results"></div>
        </div>

        <div class="test-section">
            <h3>üìä Th·ªëng k√™</h3>
            <div id="stats"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';
        let currentResults = [];

        // Mock data ƒë·ªÉ test khi API ch∆∞a s·∫µn s√†ng
        const mockApiResponse = {
            "status": {
                "code": "00",
                "success": true,
                "message": "Success",
                "responseTime": "2025-08-14T08:56:53+07:00",
                "displayMessage": "L·∫•y danh s√°ch posts th√†nh c√¥ng"
            },
            "data": [
                {
                    "id": 17,
                    "user": {
                        "senderId": "2657a6c2-0cc8-4aa9-a27b-2c3ff67a0a7f",
                        "nameSender": "Long",
                        "avatarSender": null
                    },
                    "content": "iyysiyfgijghd",
                    "visibility": "PUBLIC",
                    "createdAt": "2025-08-14T08:21:19.70395",
                    "updatedAt": "2025-08-14T08:21:19.70395",
                    "reactionCount": 0,
                    "commentCount": 0,
                    "reactions": [],
                    "comments": [],
                    "mediaUrls": []
                },
                {
                    "id": 15,
                    "user": {
                        "senderId": "0066e42c-d3f2-42e0-b410-d49f7175a168",
                        "nameSender": "Long",
                        "avatarSender": null
                    },
                    "content": "grgt",
                    "visibility": "PRIVATE",
                    "createdAt": "2025-08-11T11:01:38.955232",
                    "updatedAt": "2025-08-11T11:01:38.955232",
                    "reactionCount": 1,
                    "commentCount": 0,
                    "reactions": [
                        {
                            "id": 8,
                            "user": {
                                "senderId": "a033d64c-4286-4826-8827-f5b69af13f96",
                                "nameSender": "longbui20021008@gmail.com",
                                "avatarSender": null
                            },
                            "reactionType": "LIKE",
                            "createdAt": "2025-08-11T13:22:30.167207"
                        }
                    ],
                    "comments": [],
                    "mediaUrls": []
                },
                {
                    "id": 14,
                    "user": {
                        "senderId": "0066e42c-d3f2-42e0-b410-d49f7175a168",
                        "nameSender": "Long",
                        "avatarSender": null
                    },
                    "content": "gsdfgdsfgsdfg",
                    "visibility": "PUBLIC",
                    "createdAt": "2025-08-11T10:58:44.202352",
                    "updatedAt": "2025-08-11T10:58:44.202352",
                    "reactionCount": 1,
                    "commentCount": 0,
                    "reactions": [
                        {
                            "id": 9,
                            "user": {
                                "senderId": "a033d64c-4286-4826-8827-f5b69af13f96",
                                "nameSender": "longbui20021008@gmail.com",
                                "avatarSender": null
                            },
                            "reactionType": "LOVE",
                            "createdAt": "2025-08-11T13:48:53.627213"
                        }
                    ],
                    "comments": [],
                    "mediaUrls": [
                        "/uploads/185dceb8-f37e-4738-a3b1-bda5684562d5.jpg"
                    ]
                },
                {
                    "id": 7,
                    "user": {
                        "senderId": "54a2ce71-0722-4dc7-8123-fa046edbb653",
                        "nameSender": "John Doe",
                        "avatarSender": null
                    },
                    "content": "ƒêi ch∆°i bi·ªÉn Nha Trang th·∫≠t tuy·ªát!",
                    "visibility": "PUBLIC",
                    "createdAt": "2025-08-07T09:55:00",
                    "updatedAt": "2025-08-07T09:55:00",
                    "reactionCount": 1,
                    "commentCount": 22,
                    "reactions": [
                        {
                            "id": 1,
                            "user": {
                                "senderId": "a033d64c-4286-4826-8827-f5b69af13f96",
                                "nameSender": "longbui20021008@gmail.com",
                                "avatarSender": null
                            },
                            "reactionType": "LIKE",
                            "createdAt": "2025-08-07T10:10:00"
                        }
                    ],
                    "comments": [
                        {
                            "id": 1,
                            "user": {
                                "senderId": "54a2ce71-0722-4dc7-8123-fa046edbb653",
                                "nameSender": "john.doe@example.com",
                                "avatarSender": null
                            },
                            "content": "Tuy·ªát v·ªùi qu√°!",
                            "parentCommentId": null,
                            "createdAt": "2025-08-07T10:05:12",
                            "replies": null
                        },
                        {
                            "id": 2,
                            "user": {
                                "senderId": "a033d64c-4286-4826-8827-f5b69af13f96",
                                "nameSender": "longbui20021008@gmail.com",
                                "avatarSender": null
                            },
                            "content": "Tr·ªùi n√≥ng nh∆∞ng v·∫´n ƒë·∫πp!",
                            "parentCommentId": null,
                            "createdAt": "2025-08-07T10:06:50",
                            "replies": null
                        }
                    ],
                    "mediaUrls": []
                }
            ]
        };

        function showLoading(buttonId) {
            const icon = document.getElementById(buttonId);
            if (icon) icon.style.display = 'inline-block';
        }

        function hideLoading(buttonId) {
            const icon = document.getElementById(buttonId);
            if (icon) icon.style.display = 'none';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInHours = Math.floor((now - date) / (1000 * 60 * 60));

            if (diffInHours < 1) {
                return 'V·ª´a xong';
            } else if (diffInHours < 24) {
                return `${diffInHours} gi·ªù tr∆∞·ªõc`;
            } else {
                const diffInDays = Math.floor(diffInHours / 24);
                return `${diffInDays} ng√†y tr∆∞·ªõc`;
            }
        }

        function getVisibilityClass(visibility) {
            switch (visibility) {
                case 'PUBLIC': return 'visibility-public';
                case 'FRIENDS': return 'visibility-friends';
                case 'PRIVATE': return 'visibility-private';
                default: return 'visibility-public';
            }
        }

        function getVisibilityText(visibility) {
            switch (visibility) {
                case 'PUBLIC': return 'C√¥ng khai';
                case 'FRIENDS': return 'B·∫°n b√®';
                case 'PRIVATE': return 'Ch·ªâ m√¨nh t√¥i';
                default: return 'C√¥ng khai';
            }
        }

        function renderPost(post) {
            const userName = post.user?.nameSender || 'Ng∆∞·ªùi d√πng';
            const userInitial = userName.charAt(0).toUpperCase();
            
            return `
                <div class="post-card">
                    <div class="post-header">
                        <div class="avatar">${userInitial}</div>
                        <div class="post-info">
                            <h4>${userName}</h4>
                            <div class="post-meta">
                                ${formatDate(post.createdAt)}
                                <span class="visibility-badge ${getVisibilityClass(post.visibility)}">
                                    ${getVisibilityText(post.visibility)}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="post-content">${post.content}</div>
                    
                    ${post.mediaUrls && post.mediaUrls.length > 0 ? `
                        <div class="media">
                            <img src="${API_BASE_URL}${post.mediaUrls[0]}" alt="Post media" onerror="this.style.display='none'">
                        </div>
                    ` : ''}
                    
                    <div class="post-stats">
                        <span>‚ù§Ô∏è ${post.reactionCount} l∆∞·ª£t th√≠ch</span>
                        <span>üí¨ ${post.commentCount} b√¨nh lu·∫≠n</span>
                    </div>
                    
                    ${post.reactions && post.reactions.length > 0 ? `
                        <div class="reactions">
                            ${post.reactions.map(reaction => `
                                <span class="reaction">${reaction.reactionType} b·ªüi ${reaction.user.nameSender}</span>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${post.comments && post.comments.length > 0 ? `
                        <div class="comments">
                            ${post.comments.slice(0, 2).map(comment => `
                                <div class="comment">
                                    <strong>${comment.user.nameSender}:</strong> ${comment.content}
                                </div>
                            `).join('')}
                            ${post.comments.length > 2 ? `<div class="comment">... v√† ${post.comments.length - 2} b√¨nh lu·∫≠n kh√°c</div>` : ''}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function updateStats(data) {
            const stats = document.getElementById('stats');
            const totalPosts = data.length;
            const publicPosts = data.filter(p => p.visibility === 'PUBLIC').length;
            const privatePosts = data.filter(p => p.visibility === 'PRIVATE').length;
            const friendsPosts = data.filter(p => p.visibility === 'FRIENDS').length;
            const totalReactions = data.reduce((sum, p) => sum + p.reactionCount, 0);
            const totalComments = data.reduce((sum, p) => sum + p.commentCount, 0);
            const postsWithMedia = data.filter(p => p.mediaUrls && p.mediaUrls.length > 0).length;

            stats.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #1976d2;">${totalPosts}</div>
                        <div style="font-size: 12px; color: #666;">T·ªïng b√†i vi·∫øt</div>
                    </div>
                    <div style="background: #e8f5e8; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #388e3c;">${publicPosts}</div>
                        <div style="font-size: 12px; color: #666;">C√¥ng khai</div>
                    </div>
                    <div style="background: #fff3e0; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #f57c00;">${friendsPosts}</div>
                        <div style="font-size: 12px; color: #666;">B·∫°n b√®</div>
                    </div>
                    <div style="background: #fce4ec; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #c2185b;">${privatePosts}</div>
                        <div style="font-size: 12px; color: #666;">Ri√™ng t∆∞</div>
                    </div>
                    <div style="background: #f3e5f5; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #7b1fa2;">${totalReactions}</div>
                        <div style="font-size: 12px; color: #666;">T·ªïng l∆∞·ª£t th√≠ch</div>
                    </div>
                    <div style="background: #e0f2f1; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #00695c;">${totalComments}</div>
                        <div style="font-size: 12px; color: #666;">T·ªïng b√¨nh lu·∫≠n</div>
                    </div>
                    <div style="background: #fff8e1; padding: 15px; border-radius: 6px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #f9a825;">${postsWithMedia}</div>
                        <div style="font-size: 12px; color: #666;">C√≥ media</div>
                    </div>
                </div>
            `;
        }

        async function testGetAllPosts() {
            showLoading('loading-icon');
            const resultsDiv = document.getElementById('results');
            
            try {
                // Th·ª≠ g·ªçi API th·∫≠t tr∆∞·ªõc
                const response = await fetch(`${API_BASE_URL}/posts/all`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token') || ''}`
                    }
                });

                let data;
                if (response.ok) {
                    data = await response.json();
                    resultsDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ API call th√†nh c√¥ng! Status: ${data.status?.code || 'N/A'}
                        </div>
                    `;
                } else {
                    // N·∫øu API th·∫≠t kh√¥ng ho·∫°t ƒë·ªông, s·ª≠ d·ª•ng mock data
                    console.log('API kh√¥ng kh·∫£ d·ª•ng, s·ª≠ d·ª•ng mock data');
                    data = mockApiResponse;
                    resultsDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ S·ª≠ d·ª•ng mock data ƒë·ªÉ demo (API th·∫≠t ch∆∞a s·∫µn s√†ng)
                        </div>
                    `;
                }

                currentResults = data.data || [];
                
                // Hi·ªÉn th·ªã k·∫øt qu·∫£
                const postsHtml = currentResults.map(post => renderPost(post)).join('');
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>üìù Danh s√°ch b√†i vi·∫øt (${currentResults.length} b√†i)</h4>
                        ${postsHtml}
                    </div>
                `;

                // C·∫≠p nh·∫≠t th·ªëng k√™
                updateStats(currentResults);

            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = `
                    <div class="error">
                        ‚ùå L·ªói: ${error.message}
                    </div>
                    <div class="result">
                        <h4>üìù Demo v·ªõi Mock Data</h4>
                        ${mockApiResponse.data.map(post => renderPost(post)).join('')}
                    </div>
                `;
                currentResults = mockApiResponse.data;
                updateStats(currentResults);
            } finally {
                hideLoading('loading-icon');
            }
        }

        async function testGetPostsByPage() {
            showLoading('loading-page-icon');
            const resultsDiv = document.getElementById('results');
            
            try {
                const response = await fetch(`${API_BASE_URL}/posts/all?page=0&size=5`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token') || ''}`
                    }
                });

                let data;
                if (response.ok) {
                    data = await response.json();
                    resultsDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ API call th√†nh c√¥ng! L·∫•y 5 b√†i vi·∫øt ƒë·∫ßu ti√™n
                        </div>
                    `;
                } else {
                    data = mockApiResponse;
                    resultsDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ S·ª≠ d·ª•ng mock data ƒë·ªÉ demo ph√¢n trang
                        </div>
                    `;
                }

                const posts = (data.data || []).slice(0, 5);
                
                resultsDiv.innerHTML += `
                    <div class="result">
                        <h4>üìÑ B√†i vi·∫øt theo trang (trang 0, size 5)</h4>
                        ${posts.map(post => renderPost(post)).join('')}
                    </div>
                `;

            } catch (error) {
                console.error('Error:', error);
                resultsDiv.innerHTML = `
                    <div class="error">
                        ‚ùå L·ªói: ${error.message}
                    </div>
                `;
            } finally {
                hideLoading('loading-page-icon');
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('stats').innerHTML = '';
            currentResults = [];
        }

        // Auto test khi load trang
        window.addEventListener('load', () => {
            setTimeout(() => {
                testGetAllPosts();
            }, 1000);
        });
    </script>
</body>
</html>
